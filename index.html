<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confronto Market Cap Crypto</title>
</head>
<body>
    <h1>Confronto Market Cap Criptovalute</h1>
    <label for="crypto1">Seleziona la prima criptovaluta:</label>
    <input type="text" id="searchCrypto1" placeholder="Cerca criptovaluta...">
    <select id="crypto1"></select>

    <label for="crypto2">Seleziona la seconda criptovaluta:</label>
    <input type="text" id="searchCrypto2" placeholder="Cerca criptovaluta...">
    <select id="crypto2"></select>

    <button onclick="compareMarketCap()">Confronta Market Cap</button>

    <h2>Risultato:</h2>
    <div id="result"></div>

    <script>
        // Funzione per caricare le criptovalute disponibili nella lista in ordine di market cap
        async function loadCryptos() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc');
                const cryptos = await response.json();
                const selectCrypto1 = document.getElementById('crypto1');
                const selectCrypto2 = document.getElementById('crypto2');

                cryptos.forEach(crypto => {
                    const option1 = document.createElement('option');
                    option1.value = crypto.id;
                    option1.text = `${crypto.name} (Market Cap: $${crypto.market_cap.toLocaleString()})`;
                    selectCrypto1.add(option1);

                    const option2 = document.createElement('option');
                    option2.value = crypto.id;
                    option2.text = `${crypto.name} (Market Cap: $${crypto.market_cap.toLocaleString()})`;
                    selectCrypto2.add(option2);
                });

                // Aggiunta di funzionalit√† di ricerca intelligente
                document.getElementById('searchCrypto1').addEventListener('input', function() {
                    filterOptions('searchCrypto1', 'crypto1');
                });

                document.getElementById('searchCrypto2').addEventListener('input', function() {
                    filterOptions('searchCrypto2', 'crypto2');
                });

            } catch (error) {
                console.error('Errore durante il caricamento delle criptovalute:', error);
            }
        }

        // Funzione per filtrare le opzioni della select in base all'input di ricerca
        function filterOptions(searchInputId, selectId) {
            const searchInput = document.getElementById(searchInputId).value.toLowerCase();
            const select = document.getElementById(selectId);
            for (let i = 0; i < select.options.length; i++) {
                const optionText = select.options[i].text.toLowerCase();
                select.options[i].style.display = optionText.includes(searchInput) ? '' : 'none';
            }
        }

        loadCryptos();

        // Funzione per confrontare le market cap delle criptovalute selezionate
        async function compareMarketCap() {
            const crypto1Id = document.getElementById('crypto1').value;
            const crypto2Id = document.getElementById('crypto2').value;

            if (!crypto1Id || !crypto2Id) {
                alert('Seleziona entrambe le criptovalute per il confronto.');
                return;
            }

            try {
                const response1 = await fetch(`https://api.coingecko.com/api/v3/coins/${crypto1Id}`);
                const response2 = await fetch(`https://api.coingecko.com/api/v3/coins/${crypto2Id}`);
                const crypto1 = await response1.json();
                const crypto2 = await response2.json();

                const marketCap1 = crypto1.market_data.market_cap.usd;
                const marketCap2 = crypto2.market_data.market_cap.usd;

                const price1 = crypto1.market_data.current_price.usd;
                const multiplier = marketCap2 / marketCap1;
                const newPrice = price1 * multiplier;
                const percentageIncrease = ((multiplier - 1) * 100).toFixed(2);

                document.getElementById('result').innerHTML = `
                    <p><strong>${crypto1.name}</strong> ha una market cap di: $${marketCap1.toLocaleString()}.</p>
                    <p><strong>${crypto2.name}</strong> ha una market cap di: $${marketCap2.toLocaleString()}.</p>
                    <p>Se <strong>${crypto1.name}</strong> avesse la market cap di <strong>${crypto2.name}</strong>, il suo prezzo sarebbe di: $${newPrice.toFixed(2)}.</p>
                    <p>Questo rappresenta un incremento del <strong>${percentageIncrease}%</strong> rispetto al prezzo attuale.</p>
                `;
            } catch (error) {
                console.error('Errore durante il confronto delle market cap:', error);
            }
        }
    </script>
</body>
</html>
